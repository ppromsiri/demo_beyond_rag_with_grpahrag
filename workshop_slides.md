---
marp: true
theme: gaia
paginate: true
backgroundColor: #fff
header: Beyond RAG with GraphRAG
footer: Demo Workshop
---

# **Beyond RAG with GraphRAG**

## ค้นหาข้อมูลเชิงลึกเกินกว่าการค้นหาตามความหมาย

---

## **Agenda (วัตถุประสงค์)**

1.  **Introduction** - ทบทวน RAG และปัญหาของการตัดข้อความ (Chunking)
2.  **Demo 1: Standard RAG (The "Before")** - แสดงการทำงานและข้อจำกัดด้วย Qdrant
3.  **Demo 2: GraphRAG (The "After")** - แสดงพลังของการค้นหาด้วยกราฟใน Neo4j
4.  **Conclusion & Q&A** - สรุปและเปิดรับคำถาม

---

## **Part 1: Introduction**

### **RAG คืออะไร?**

- **R**etrieval-**A**ugmented **G**eneration
- เป็นเทคนิคที่ดึงข้อมูลที่เกี่ยวข้องจากแหล่งข้อมูลภายนอก (Knowledge Base) มาเป็นบริบท (Context) ให้กับ Large Language Model (LLM)
- ทำให้ LLM ตอบคำถามได้ถูกต้องและเป็นปัจจุบันมากขึ้น

```
User Query -> [Retrieve] -> Context + Query -> [LLM] -> Answer
```

---

## **Part 1: Introduction**
### **ปัญหาของ RAG แบบเดิม (The "Chunking Problem")**
การทำงานแบบดั้งเดิม (Naive RAG) จะตัดเอกสารเป็นชิ้นเล็กๆ (Chunks) ซึ่งนำไปสู่ปัญหา:
1.  **Loss of Context (สูญเสียบริบท):**
    - ข้อมูลที่เชื่อมโยงกันอาจถูกตัดอยู่คนละ Chunk
    - ทำให้การค้นหาดูเห็นเพียงบางส่วนของเรื่อง
2.  **Semantic vs. Relational Search:**
    - การค้นหาแบบ Cosine Similarity หา "ข้อความที่คล้ายกัน" ไม่ใช่ "ความสัมพันธ์ที่แท้จริง"
    - **ตัวอย่าง:** ค้นหา "สินเชื่อสำหรับครู วงเงิน 100,000"
    - อาจไปเจอ Chunk ที่มีคำว่า "ครู" และ Chunk อื่นที่มีคำว่า "100,000" แต่ไม่ได้มาจากโครงการเดียวกัน

---

## **Part 1: Introduction**

### **แนะนำ GraphRAG: คำตอบของปัญหา**

GraphRAG แก้ปัญหานี้โดยการแปลงข้อมูลจากข้อความธรรมดาให้กลายเป็น **Knowledge Graph**

- **Entities (เอนทิตี):** บุคคล, สถานที่, สิ่งของ, แนวคิด (เช่น `สินเชื่อเกษตรวิวัฒน์`, `ครู`, `ดอกเบี้ย 9.25%`)
- **Relationships (ความสัมพันธ์):** การเชื่อมโยงระหว่างเอนทิตี (เช่ง `(สินเชื่อ A) -[:มีเป้าหมาย]-> (ครู)`)

**ผลลัพธ์:** ข้อมูลมีโครงสร้างและความสัมพันธ์ที่ชัดเจน พร้อมสำหรับการค้นหาเชิงลึก

---

## **Part 2: Demo 1 - Standard RAG (The "Before")**

### **Flow การทำงาน**

เราจะใช้ไฟล์ Markdown 5 ไฟล์เกี่ยวกับสินเชื่อมาทดลอง

```
Markdown Files
      |
      v
[Chunking (Fixed Size)]
      |
      v
[Embedding (Vector)]
      |
      v
[Store in Qdrant (Vector DB)]
      |
      v
[Search with Cosine Similarity]
```

---

## **Part 2: Demo 1 - Standard RAG (The "Before")**

### **ผลลัพธ์ใน Qdrant**

ข้อมูลใน Qdrant จะเก็บเป็นชิ้นส่วน (Chunks) ของข้อความ พร้อมกับเวกเตอร์ที่แทนความหมาย

```json
{
  "id": 123,
  "vector": [0.1, -0.4, ...],
  "payload": {
    "source": "loan1.md",
    "text": "คุณสมบัติผู้กู้ 1. ดำรงตำแหน่งกำนัน ผู้ใหญ่บ้าน ... 2. มีคุณสมบัติตามข้อบังคับ..."
  }
}
```

**ดูแล้วเหมือนชิ้นส่วนของปริศนาที่กระจัดกระจาย**

---

## **Part 2: Demo 1 - Standard RAG (The "Before")**

### **ทดสอบการค้นหา: Query ที่น่าจะหาเจอ**

**Query:** `"วัตถุประสงค์ของสินเชื่อเพื่อบุคลากรด้านสาธารณสุข"`

**ผลลัพธ์ที่คาดหวัง:** ได้ข้อความที่เกี่ยวข้องจาก `loan1.md` โดยตรง
**Score:** สูงมาก (เช่น 0.95)

---

## **Part 2: Demo 1 - Standard RAG (The "Before")**

### **ทดสอบการค้นหา: Query ที่เป็นปัญหา**

**Query:** `"ผมเป็นครู อยากกู้เงิน 100,000 บาท มีโครงการไหนแนะนำบ้าง"`

**ผลลัพธ์ที่ RAG อาจตอบ:**
- อาจไปดึงข้อมูลจาก `loan5.md` (สินเชื่อบุคลากรการศึกษา) ที่มีคำว่า "ครู" แต่วงเงินสูงสุดแค่ 20,000 บาท
- หรือไปดึงข้อมูลจาก `loan1.md` (สินเชื่อสาธารณสุข) ที่มีวงเงิน 100,000 บาท แต่เป้าหมายไม่ใช่ครู

**สรุป:** RAG สับสน! มันไม่เข้าใจว่า "เป็นครู" และ "ต้องการ 100,000" เป็นเงื่อนไขที่ต้องเกิดพร้อมกัน

---

## **Part 3: Demo 2 - GraphRAG (The "After")**

### **Flow การทำงาน**

เราจะแปลงข้อมูลเดิมให้เป็นกราฟแทน

```
Markdown Files
      |
      v
[Extract Entities & Relationships]
      |
      v
[Create Nodes & Relations]
      |
      v
[Store in Neo4j (Graph DB)]
      |
      v
[Query with Cypher (Graph Language)]
```

---

## **Part 3: Demo 2 - GraphRAG (The "After")**

### **ผลลัพธ์ใน Neo4j**

ข้อมูลใน Neo4j จะเป็นกราฟของ Node และ Relationship ที่เชื่อมโยงกัน

- **Node สีฟ้า:** `LoanProject` (โครงการสินเชื่อ)
- **Node สีเขียว:** `Profession` (อาชีพเป้าหมาย)
- **Node สีส้ม:** `LoanLimit` (วงเงิน)
- **เส้นเชื่อม:** `IS_FOR`, `HAS_LIMIT`, `HAS_INTEREST_RATE`

**ดูแล้วเห็นภาพรวมและความสัมพันธ์ชัดเจน!**

---

## **Part 3: Demo 2 - GraphRAG (The "After")**

### **ทดสอบการค้นหา: แก้ปัญหาเดิม**

**คำถามเดิม:** "หาสินเชื่อสำหรับครูที่วงเงินสูงสุดไม่ต่ำกว่า 100,000 บาท"

**Cypher Query:**
```cypher
MATCH (p:Profession {name: 'บุคลากรทางการศึกษา'})<-[:IS_FOR]-(l:LoanProject)-[:HAS_LIMIT]->(limit:LoanLimit)
WHERE toInteger(replace(limit.value, ',', '')) >= 100000
RETURN l.name, limit.value
```

**ผลลัพธ์:** `(no changes, no records)` -> **ไม่มีผลลัพธ์**

**นี่คือคำตอบที่ถูกต้อง!** เพราะ GraphRAG เข้าใจว่าไม่มีโครงการไหนตรงตามเงื่อนไขที่ซับซ้อนนี้เลย

---

## **Part 3: Demo 2 - GraphRAG (The "After")**

### **ทดสอบการค้นหา: แสดงความสามารถ**

**คำถามใหม่:** "โครงการไหนที่ต้องการค้ำประกันโดยคนในอำเภอเดียวกัน และดอกเบี้ยคงที่"

**Cypher Query:**
```cypher
MATCH (l:LoanProject)-[:HAS_INTEREST_RATE]->(ir:InterestRate {type: 'คงที่'})
WHERE l.collateral_condition CONTAINS 'อำเภอเดียวกัน'
RETURN l.name, ir.value
```

**ผลลัพธ์:**
- `สินเชื่อเพื่อบุคลากรด้านสาธารณสุข` | `9.25%`
- `สินเชื่อเพื่อเป็นสวัสดิการสำหรับ กำนัน ผู้ใหญ่บ้าน` | `9.25%`

**ตอบโจทย์ได้แม่นยำและเฉพาะเจาะจงมาก!**

---

## **Part 4: Conclusion & Q&A**

### **สรุป: RAG vs. GraphRAG**

| Feature | Standard RAG (Vector Search) | GraphRAG |
|---|---|---|
| **การทำงาน** | ค้นหาจากความคล้ายคลึงของข้อความ | ค้นหาจากความสัมพันธ์ของเอนทิตี |
| **จุดแข็ง** | เหมาะกับ Semantic Search, หาคำตอบจากเอกสารขนาดใหญ่ | เหมาะกับข้อมูลที่มีความสัมพันธ์ซับซ้อน, ต้องการความแม่นยำ |
| **จุดอ่อน** | สูญเสียบริบท, ตอบคำถามที่ซับซ้อนได้ไม่ดี | ต้องการการประมวลผลเพื่อสร้างกราฟ (Extract) |
| **เคสที่ใช้** | ค้นหาข้อมูลทั่วไป, สรุปเนื้อหา | ระบบแนะนำ, การวิเคราะห์ความสัมพันธ์, การตอบคำถามที่มีเงื่อนไขหลายอย่าง |

---

## **Part 4: Conclusion & Q&A**

### **เลือกใช้อย่างไร?**

- **ใช้ RAG แบบดั้งเดิม:** เมื่อข้อมูลของคุณเป็นเอกสารข้อความยาวๆ ที่ไม่ได้มีเอนทิตีและความสัมพันธ์ที่ชัดเจน (เช่น บทความ, รายงานวิจัย)
- **ใช้ GraphRAG:** เมื่อข้อมูลของคุณเต็มไปด้วย "นิยาม" และ "ความสัมพันธ์" (เช่น ข้อมูลสินเชื่อ, ข้อมูลผลิตภัณฑ์, โครงสร้างองค์กร)

**ทั้งสองวิธีไม่ใช่คู่แข่ง แต่เป็นเครื่องมือที่เสริมซึ่งกันและกัน**

---

## **Q&A**

### **ขอบคุณที่ร่วม Workshop ครับ**

**พร้อมเปิดรับคำถามครับ**